<ControlTheme xmlns="https://github.com/avaloniaui"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:atom="https://atomui.net"
              xmlns:themes="using:AtomUI.Controls.Themes"
              TargetType="atom:LineEdit"
              x:Class="AtomUI.Controls.Themes.LineEditTheme"
              x:ClassModifier="internal">
    <ControlTheme.BasedOn>
        <themes:TextBoxTheme TargetType="{x:Type atom:LineEdit}" />
    </ControlTheme.BasedOn>
    <Setter Property="Template">
        <ControlTemplate TargetType="atom:LineEdit">
            <atom:AddOnDecoratedBox
                LeftAddOn="{TemplateBinding LeftAddOn}"
                LeftAddOnTemplate="{TemplateBinding LeftAddOnTemplate}"
                RightAddOn="{TemplateBinding RightAddOn}"
                RightAddOnTemplate="{TemplateBinding RightAddOnTemplate}"
                ContentLeftAddOn="{TemplateBinding InnerLeftContent}"
                StyleVariant="{TemplateBinding StyleVariant}"
                SizeType="{TemplateBinding SizeType}"
                Status="{TemplateBinding Status}"
                Focusable="True">
                <atom:AddOnDecoratedBox.ContentRightAddOn>
                    <StackPanel Orientation="Horizontal" Spacing="{DynamicResource {x:Static atom:SharedTokenKey.UniformlyPaddingXXS}}">
                        <atom:IconButton
                            Name="{x:Static atom:TextBoxThemeConstants.ClearButtonPart}"
                            Icon="{atom:IconProvider CloseCircleFilled}"
                            IconWidth="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}"
                            IconHeight="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}"
                            NormalIconBrush="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextQuaternary}}"
                            ActiveIconBrush="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextTertiary}}"
                            SelectedIconBrush="{DynamicResource {x:Static atom:SharedTokenKey.ColorText}}"
                            IsMotionEnabled="{Binding IsMotionEnabled, RelativeSource={RelativeSource AncestorType=atom:LineEdit}}"
                            IsVisible="{Binding IsEffectiveShowClearButton, RelativeSource={RelativeSource AncestorType=atom:LineEdit}}" />
                        <!-- 新增显示密码按钮 -->
                        <atom:ToggleIconButton
                            Name="{x:Static atom:TextBoxThemeConstants.RevealButtonPart}"
                            CheckedIcon="{atom:IconProvider EyeOutlined}"
                            UnCheckedIcon="{atom:IconProvider EyeInvisibleOutlined}"
                            IconWidth="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}"
                            IconHeight="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}"
                            NormalIconBrush="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextTertiary}}"
                            ActiveIconBrush="{DynamicResource {x:Static atom:SharedTokenKey.ColorText}}"
                            SelectedIconBrush="{DynamicResource {x:Static atom:SharedTokenKey.ColorText}}"
                            IsChecked="{Binding RevealPassword, RelativeSource={RelativeSource AncestorType=atom:LineEdit}, Mode=TwoWay}"
                            IsVisible="{Binding IsEnableRevealButton, RelativeSource={RelativeSource AncestorType=atom:LineEdit}}" />
                        <ContentPresenter
                            VerticalAlignment="Stretch"
                            VerticalContentAlignment="Center"
                            HorizontalAlignment="Right"
                            Focusable="False"
                            Content="{Binding InnerRightContent, RelativeSource={RelativeSource AncestorType=atom:LineEdit}}"
                            IsVisible="{Binding InnerRightContent, RelativeSource={RelativeSource AncestorType=atom:LineEdit}, Converter={x:Static ObjectConverters.IsNotNull}}"/>
                    </StackPanel>
                </atom:AddOnDecoratedBox.ContentRightAddOn>
                
                <ScrollViewer
                    Name="ScrollViewer"
                    Cursor="Ibeam"
                    AllowAutoHide="{TemplateBinding ScrollViewer.AllowAutoHide}"
                    HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}"
                    VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}"
                    IsScrollChainingEnabled="{TemplateBinding ScrollViewer.IsScrollChainingEnabled}">
                    <Panel>
                        <atom:TextBlock
                            Name="Watermark"
                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                            Text="{TemplateBinding Watermark}"
                            LineHeight="{TemplateBinding LineHeight}"
                            TextAlignment="{TemplateBinding TextAlignment}"
                            TextWrapping="{TemplateBinding TextWrapping}"
                            IsVisible="{TemplateBinding Text, Converter={x:Static StringConverters.IsNullOrEmpty}}" />
                        <TextPresenter
                            Name="PART_TextPresenter"
                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                            CaretBlinkInterval="{TemplateBinding CaretBlinkInterval}"
                            CaretBrush="{TemplateBinding CaretBrush}"
                            CaretIndex="{TemplateBinding CaretIndex}"
                            LineHeight="{TemplateBinding LineHeight}"
                            PasswordChar="{TemplateBinding PasswordChar}"
                            RevealPassword="{TemplateBinding RevealPassword}"
                            SelectionBrush="{TemplateBinding SelectionBrush}"
                            SelectionStart="{TemplateBinding SelectionStart}"
                            SelectionEnd="{TemplateBinding SelectionEnd}"
                            SelectionForegroundBrush="{TemplateBinding SelectionForegroundBrush}"
                            Text="{TemplateBinding Text, Mode=TwoWay}"
                            TextAlignment="{TemplateBinding TextAlignment}"
                            TextWrapping="{TemplateBinding TextWrapping}" />
                    </Panel>
                </ScrollViewer>
            </atom:AddOnDecoratedBox>
        </ControlTemplate>
    </Setter>

    <Style Selector="^:is(atom|LineEdit)">
        <Setter Property="IsMotionEnabled" Value="{DynamicResource {x:Static atom:SharedTokenKey.EnableMotion}}" />
        
        <Style Selector="^[StyleVariant=Borderless]">
            <Style Selector="^:error">
                <Style Selector="^ /template/ ScrollViewer#ScrollViewer">
                    <Setter Property="Foreground"
                            Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorErrorText}}" />
                </Style>
            </Style>
            <Style Selector="^:warning">
                <Style Selector="^ /template/ ScrollViewer#ScrollViewer">
                    <Setter Property="Foreground"
                            Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorWarningText}}" />
                </Style>
            </Style>
        </Style>
        <Style Selector="^[StyleVariant=Filled]">
            <Style Selector="^:error">
                <Style Selector="^ /template/ ScrollViewer#ScrollViewer">
                    <Setter Property="Foreground"
                            Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorErrorText}}" />
                </Style>
            </Style>
            <Style Selector="^:warning">
                <Style Selector="^ /template/ ScrollViewer#ScrollViewer">
                    <Setter Property="Foreground"
                            Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorWarningText}}" />
                </Style>
            </Style>
        </Style>
    </Style>

</ControlTheme>