<ControlTheme xmlns="https://github.com/avaloniaui"
              xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
              xmlns:atom="https://atomui.net"
              x:Class="AtomUI.Desktop.Controls.Themes.TextBoxTheme"
              xmlns:antdicons="https://atomui.net/icons/antdesign"
              x:ClassModifier="internal"
              TargetType="atom:TextBox">
    <Setter Property="Template">
        <ControlTemplate TargetType="atom:TextBox">
            <Border
                Name="InnerBoxDecorator"
                Padding="{TemplateBinding Padding}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="{TemplateBinding CornerRadius}"
                BorderBrush="{TemplateBinding BorderBrush}"
                Background="{TemplateBinding Background}">
                <DockPanel Name="ContentLayout" LastChildFill="True">
                    <StackPanel
                        Name="{x:Static atom:AddOnDecoratedBoxThemeConstants.LeftAddOnLayoutPart}"
                        Orientation="Horizontal"
                        DockPanel.Dock="Left">
                        <ContentPresenter
                            Name="{x:Static atom:AddOnDecoratedBoxThemeConstants.LeftAddOnPart}"
                            VerticalAlignment="Stretch"
                            VerticalContentAlignment="Center"
                            HorizontalAlignment="Left"
                            Focusable="False"
                            Content="{TemplateBinding InnerLeftContent}"/>
                    </StackPanel>
            
                    <StackPanel
                        Name="{x:Static atom:AddOnDecoratedBoxThemeConstants.RightAddOnLayoutPart}"
                        Orientation="Horizontal"
                        DockPanel.Dock="Right">
                        <atom:IconButton
                            Name="{x:Static atom:TextBoxThemeConstants.ClearButtonPart}"
                            Icon="{antdicons:AntDesignIconProvider CloseCircleFilled}"
                            IsVisible="{TemplateBinding IsEffectiveShowClearButton}" />
                        <!-- 新增显示密码按钮 -->
                        <atom:ToggleIconButton
                            Name="{x:Static atom:TextBoxThemeConstants.RevealButtonPart}"
                            CheckedIcon="{antdicons:AntDesignIconProvider EyeOutlined}"
                            UnCheckedIcon="{antdicons:AntDesignIconProvider EyeInvisibleOutlined}"
                            IsChecked="{TemplateBinding RevealPassword, Mode=TwoWay}"
                            IsVisible="{TemplateBinding IsEnableRevealButton}" />
                        <ContentPresenter
                            Name="{x:Static atom:AddOnDecoratedBoxThemeConstants.RightAddOnPart}"
                            VerticalAlignment="Stretch"
                            VerticalContentAlignment="Center"
                            HorizontalAlignment="Right"
                            IsVisible="{TemplateBinding InnerRightContent, Converter={x:Static ObjectConverters.IsNotNull}}"
                            Content="{TemplateBinding InnerRightContent}"/>
                        <atom:TextBlock Name="TextCountIndicator" 
                                        VerticalAlignment="Center"
                                        Text="{TemplateBinding CountText}"
                                        IsVisible="{TemplateBinding IsShowCount}"/>
                    </StackPanel>
            
                    <ScrollViewer
                        Name="ScrollViewer"
                        Cursor="Ibeam"
                        AllowAutoHide="{TemplateBinding ScrollViewer.AllowAutoHide}"
                        HorizontalScrollBarVisibility="{TemplateBinding ScrollViewer.HorizontalScrollBarVisibility}"
                        VerticalScrollBarVisibility="{TemplateBinding ScrollViewer.VerticalScrollBarVisibility}"
                        IsScrollChainingEnabled="{TemplateBinding ScrollViewer.IsScrollChainingEnabled}">
                        <Panel>
                            <atom:TextBlock
                                Name="Watermark"
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                Text="{TemplateBinding Watermark}"
                                Foreground="{TemplateBinding WatermarkForeground}"
                                LineHeight="{TemplateBinding LineHeight}"
                                TextAlignment="{TemplateBinding TextAlignment}"
                                TextWrapping="{TemplateBinding TextWrapping}"
                                IsVisible="{TemplateBinding Text, Converter={x:Static StringConverters.IsNullOrEmpty}}" />
                            <TextPresenter
                                Name="PART_TextPresenter"
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                CaretBlinkInterval="{TemplateBinding CaretBlinkInterval}"
                                CaretBrush="{TemplateBinding CaretBrush}"
                                CaretIndex="{TemplateBinding CaretIndex}"
                                LineHeight="{TemplateBinding LineHeight}"
                                PasswordChar="{TemplateBinding PasswordChar}"
                                RevealPassword="{TemplateBinding RevealPassword}"
                                SelectionBrush="{TemplateBinding SelectionBrush}"
                                SelectionStart="{TemplateBinding SelectionStart}"
                                SelectionEnd="{TemplateBinding SelectionEnd}"
                                SelectionForegroundBrush="{TemplateBinding SelectionForegroundBrush}"
                                Text="{TemplateBinding Text, Mode=TwoWay}"
                                TextAlignment="{TemplateBinding TextAlignment}"
                                TextWrapping="{TemplateBinding TextWrapping}" />
                        </Panel>
                    </ScrollViewer>
                </DockPanel>
            </Border>
        </ControlTemplate>
    </Setter>

    <Style Selector="^:is(atom|TextBox)">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="SelectionBrush" Value="{DynamicResource {x:Static atom:SharedTokenKey.SelectionBackground}}" />
        <Setter Property="CaretBrush" Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorText}}" />
        <Setter Property="SelectionForegroundBrush"
                Value="{DynamicResource {x:Static atom:SharedTokenKey.SelectionForeground}}" />
        <Setter Property="HorizontalAlignment" Value="Stretch" />
        <Setter Property="VerticalAlignment" Value="Top" />
        <Setter Property="VerticalContentAlignment" Value="Center" />
        <Setter Property="ScrollViewer.IsScrollChainingEnabled" Value="True" />
    
        <Style Selector="^ /template/ atom|ToggleIconButton#PART_RevealButton">
            <Setter Property="IconWidth" Value="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}" />
            <Setter Property="IconHeight" Value="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}" />
            <Setter Property="NormalIconBrush"
                    Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextTertiary}}" />
            <Setter Property="ActiveIconBrush" Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorText}}" />
            <Setter Property="SelectedIconBrush" Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorText}}" />
        </Style>
    
        <Style Selector="^[SizeType=Large]">
            <Setter Property="LineHeight" Value="{DynamicResource {x:Static atom:SharedTokenKey.FontHeightLG}}" />
        </Style>
        <Style Selector="^[SizeType=Middle]">
            <Setter Property="LineHeight" Value="{DynamicResource {x:Static atom:SharedTokenKey.FontHeight}}" />
        </Style>
        <Style Selector="^[SizeType=Small]">
            <Setter Property="LineHeight" Value="{DynamicResource {x:Static atom:SharedTokenKey.FontHeightSM}}" />
            <Style Selector="^ /template/ TextPresenter#PART_TextPresenter">
                <Setter Property="Margin" Value="0, 1, 0, 1" />
            </Style>
        </Style>
    
        <Style Selector="^[IsCustomFontSize=False]">
            <Style Selector="^[SizeType=Large]">
                <Setter Property="FontSize" Value="{DynamicResource {x:Static atom:LineEditTokenKey.InputFontSizeLG}}" />
            </Style>
            <Style Selector="^[SizeType=Middle]">
                <Setter Property="FontSize" Value="{DynamicResource {x:Static atom:LineEditTokenKey.InputFontSize}}" />
            </Style>
            <Style Selector="^[SizeType=Small]">
                <Setter Property="FontSize" Value="{DynamicResource {x:Static atom:LineEditTokenKey.InputFontSizeSM}}" />
            </Style>
        </Style>
    
        <Setter Property="WatermarkForeground" Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextPlaceholder}}" />

        <Style Selector="^ /template/ TextPresenter#PART_TextPresenter">
            <Setter Property="Margin"
                    Value="2 0 2 0" />
        </Style>
    
        <Style Selector="^ /template/ StackPanel#PART_LeftAddOnLayout, ^ /template/ StackPanel#PART_RightAddOnLayout">
            <Setter Property="Spacing"
                    Value="{DynamicResource {x:Static atom:SharedTokenKey.UniformlyPaddingXXS}}" />
        </Style>
    
        <Style Selector="^ /template/ atom|IconButton#PART_ClearButton">
            <Setter Property="IconWidth" Value="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}" />
            <Setter Property="IconHeight" Value="{DynamicResource {x:Static atom:SharedTokenKey.IconSize}}" />
            <Setter Property="NormalIconBrush"
                    Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextQuaternary}}" />
            <Setter Property="ActiveIconBrush"
                    Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextTertiary}}" />
            <Setter Property="SelectedIconBrush" Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorText}}" />
        </Style>
        
        <Style Selector="^ /template/ atom|TextBlock#TextCountIndicator">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextPlaceholder}}" />
        </Style>
        
        <Style Selector="^:disabled">
            <Style Selector="^ /template/ ScrollViewer#PART_ScrollViewer">
                <Setter Property="Foreground" Value="{DynamicResource {x:Static atom:SharedTokenKey.ColorTextDisabled}}" />
            </Style>
        </Style>
    </Style>
</ControlTheme>